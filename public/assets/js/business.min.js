/*!
 * Start Bootstrap - SB Admin v4.0.0-beta (https://startbootstrap.com/template-overviews/sb-admin)
 * Copyright 2013-2017 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin/blob/master/LICENSE)
 */
function applyHandlers(){$(".listRemove").off(),$(".listRemove").each(function(){$(this).on("click",function(e){var t=$(this).data("id"),i=vm.payload.invoice.email_list.indexOf(t);i>=0&&vm.payload.invoice.email_list.splice(i,1)})})}var vm=new Vue({el:"#app",data:{payload:{payment:{currency:"",method:"",stripe_customer_id:"",stripe_token_id:""},invoice:{day_of_month:"",email_list:[],country:"",province:"",postal:"",city:"",addr2:"",addr1:""},category:"",parent:"",name:"",id:""},form:{parent:"",credit_card_result:"",email:""},voidInvoiceId:""},delimiters:["<%","%>"],methods:{addEmail:function(){this.payload.invoice.email_list.push(this.form.email)},removeEmail:function(e){remove(this.payload.invoice.email_list,e)},hasCreditCardResult:function(){return""!==this.form.credit_card_result},submit:function(){$.ajax({method:"POST",type:"POST",url:"/api/business",data:this.payload,success:function(e){window.location="/business/edit/"+e.id},dataType:"json"})},voidInvoice:function(){$.ajax({method:"POST",type:"POST",url:"/api/invoice/void/"+this.voidInvoiceId,success:function(e){window.location="/business/edit/"+e.id},dataType:"json"})},setVoidInvoiceId:function(e){this.voidInvoiceId=e}},mounted:function(){$("#parent").autocomplete({source:"/api/business/auto-complete",minLength:2,select:function(e,t){vm.payload.parent=t.item.id}}),applyHandlers()},updated:function(){applyHandlers()}}),stripe=Stripe("{{ stripe }}"),elements=stripe.elements(),style={base:{color:"#32325d",lineHeight:"24px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},card=elements.create("card",{style:style,hidePostalCode:!0});card.mount("#card-element"),card.addEventListener("change",function(e){var t=document.getElementById("card-errors");e.error?t.textContent=e.error.message:t.textContent=""});var form=document.getElementById("payment-form");form.addEventListener("submit",function(e){e.preventDefault(),stripe.createSource(card,{}).then(function(e){if(e.error)document.getElementById("card-errors").textContent=e.error.message;else{var t={customer_id:vm.payload.payment.stripe_customer_id,source:e.source};$.ajax({type:"POST",url:"/api/stripe/customer",data:t,dataType:"json",success:function(e){vm.payload.payment.stripe_customer_id=e.id}})}})});